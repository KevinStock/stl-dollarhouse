<!doctype html>
<html>

<head>
  <title>STL Dollar House - {% block title %}{% endblock %}</title>
  <link rel="stylesheet" href="https://meyerweb.com/eric/tools/css/reset/reset.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <meta charset='utf-8'>
</head>

<body>
  <nav>
    <ul>
      <li>Map</li>
      <li>List</li>
    </ul>
  </nav>
  {% block content %}{% endblock %}
  <script>
    // initialize map with markers
    var map;
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: 38.6272700,
          lng: -90.1978900
        },
        zoom: 10
      });
      var bounds = new google.maps.LatLngBounds();
      {% for prop in properties %}
        var address = '{{ prop['Address'] }}';
        var Lat = '{{ prop['Latitude'] }}';
        var Lng = '{{ prop['Longitude'] }}';
        var latLng = new google.maps.LatLng(Lat, Lng);
        var marker = new google.maps.Marker({
          position: latLng,
          map: map,
          title: address
        });
        bounds.extend(latLng);
        var content = '<strong>' + address + '</strong><br><img src="https://maps.googleapis.com/maps/api/streetview?size=400x400&key={{gkey}}&location=' + Lat + ',' + Lng + '">';
        var infowindow = new google.maps.InfoWindow();
        google.maps.event.addListener(marker,'click',(function(marker,content,infowindow){
          return function() {
            infowindow.setContent(content);
            infowindow.open(map,marker);
          };
        })(marker,content,infowindow));
      {% endfor %}
      map.fitBounds(bounds);
      map.setCenter(bounds.getCenter());
    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key={{gkey}}&callback=initMap" async defer></script>
</body>

</html>